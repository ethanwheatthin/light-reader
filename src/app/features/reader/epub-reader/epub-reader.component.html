<div class="epub-container" [attr.data-theme]="theme()">
  <!-- Reading progress bar -->
  <app-reading-progress [progress]="readingProgress$ | async" [theme]="theme()"></app-reading-progress>

  <!-- Unified settings panel -->
  <app-unified-settings-panel
    [isOpen]="panelOpen()"
    [theme]="theme()"
    [settings]="currentSettings"
    [chapters]="chapters()"
    [currentChapter]="currentChapterHref()"
    [bookmarks]="(bookmarks$ | async) ?? []"
    [readingStats]="(readingStats$ | async) ?? null"
    [readingGoal]="(readingGoal$ | async) ?? null"
    [todayReadingTime]="(todayReadingTime$ | async) ?? null"
    (close)="togglePanel()"
    (settingsChange)="onSettingsChange($event)"
    (chapterSelect)="onChapterSelect($event)"
    (bookmarkJump)="jumpToBookmark($event)"
    (bookmarkRemove)="removeBookmark($event)">
  </app-unified-settings-panel>

  <div #viewer class="epub-viewer"></div>
  <!-- Top bar: navigation + settings toggle -->
  <div class="reader-controls">
    <button
      class="bookmark-toggle"
      (click)="toggleBookmarkAtCurrentLocation()"
      [class.bookmarked]="isCurrentLocationBookmarked()"
      [attr.aria-label]="isCurrentLocationBookmarked() ? 'Remove bookmark' : 'Add bookmark'"
      title="Toggle bookmark">
      {{ isCurrentLocationBookmarked() ? 'ğŸ”–' : 'ğŸ·ï¸' }}
    </button>

    <button (click)="prevPage()" [disabled]="!canGoPrev" aria-label="Previous page">Previous</button>
    <span class="page-info">{{ currentLocation }}</span>
    <button (click)="nextPage()" [disabled]="!canGoNext" aria-label="Next page">Next</button>

    @if (estimatedTimeRemaining$ | async; as eta) {
      <span class="eta-badge" title="Estimated time remaining">{{ eta }}</span>
    }

    <button
      class="panel-toggle"
      (click)="togglePanel()"
      [attr.aria-expanded]="panelOpen()"
      aria-label="Open settings panel"
      title="Settings & More">
      âš™ï¸
    </button>
  </div>
</div>
